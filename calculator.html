<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Xenium Price Calculator — ATG-C</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* ── Calculator-specific styles ─────────────────────────── */
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ── Main Content ─────────────────────────────────────── */
    .page-main {
      flex: 1;
      max-width: 640px;
      width: 100%;
      margin: 0 auto;
      padding: 100px 24px 64px;
    }

    .calc-page-title {
      font-size: 32px;
      font-weight: 600;
      color: #111827;
      margin-bottom: 8px;
    }

    .calc-page-subtitle {
      font-size: 14px;
      color: #6B7280;
      margin-bottom: 32px;
    }

    /* ── Calculator Card ──────────────────────────────────── */
    .calc-card {
      background: #F8FAFC;
      border: 1px solid #E5E7EB;
      border-radius: 8px;
      padding: 32px;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-group:last-of-type {
      margin-bottom: 0;
    }

    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: #111827;
      margin-bottom: 6px;
    }

    .form-group select {
      width: 100%;
      padding: 10px 12px;
      font-family: inherit;
      font-size: 16px;
      font-weight: 400;
      color: #374151;
      background: #FFFFFF;
      border: 1px solid #E5E7EB;
      border-radius: 6px;
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' fill='none'%3E%3Cpath d='M1 1.5l5 5 5-5' stroke='%236B7280' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      cursor: pointer;
      transition: border-color 0.15s;
    }

    .form-group select:hover {
      border-color: #9CA3AF;
    }

    .form-group select:focus {
      outline: none;
      border-color: #2563EB;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.12);
    }

    /* ── Empty-state message for Prime/5k premade ─────────── */
    .panel-empty {
      font-size: 14px;
      color: #6B7280;
      font-style: italic;
      padding: 10px 0;
    }

    /* ── Results ──────────────────────────────────────────── */
    .results {
      margin-top: 32px;
      border-top: 1px solid #E5E7EB;
      padding-top: 24px;
    }

    .results-heading {
      font-size: 14px;
      font-weight: 500;
      color: #6B7280;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 16px;
    }

    .result-line {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      padding: 4px 0;
      font-size: 16px;
      font-weight: 400;
      color: #374151;
    }

    .result-line .label {
      flex: 1;
    }

    .result-line .value {
      font-variant-numeric: tabular-nums;
      text-align: right;
    }

    .result-line.indent {
      padding-left: 16px;
      font-size: 14px;
      color: #6B7280;
    }

    .result-line.indent .label {
      font-style: italic;
    }

    .result-divider {
      border: none;
      border-top: 1px solid #E5E7EB;
      margin: 12px 0;
    }

    .result-total {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      padding: 8px 12px;
      margin-top: 4px;
      background: #EFF6FF;
      border-radius: 6px;
      font-size: 20px;
      font-weight: 600;
      color: #2563EB;
    }

    .result-per-run {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      padding: 6px 0;
      margin-top: 8px;
      font-size: 14px;
      color: #6B7280;
    }

    .cost-note {
      margin-top: 16px;
      padding: 12px;
      background: #FEF3C7;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      color: #92400E;
      line-height: 1.5;
    }

    /* ── Responsive ───────────────────────────────────────── */
    @media (max-width: 480px) {
      .page-main { padding: 80px 16px 48px; }
      .calc-card { padding: 20px; }
      .calc-page-title { font-size: 26px; }
      .result-total { font-size: 18px; }
    }
  </style>
</head>
<body>

  <!-- ===== STICKY NAV ===== -->
  <header class="site-header" id="site-header">
    <nav class="nav-container" aria-label="Main navigation">
      <a href="index.html" class="nav-logo" aria-label="ATG-C home">
        <img src="images/atgc-logo.svg" alt="ATG-C" width="140" height="40">
      </a>

      <button class="nav-toggle" id="nav-toggle" aria-label="Open menu" aria-expanded="false" aria-controls="nav-menu">
        <span class="nav-toggle-bar"></span>
        <span class="nav-toggle-bar"></span>
        <span class="nav-toggle-bar"></span>
      </button>

      <ul class="nav-menu" id="nav-menu" role="list">
        <li class="nav-dropdown">
          <button class="nav-dropdown-trigger" aria-expanded="false" aria-haspopup="true">
            Technologies <span class="nav-dropdown-caret" aria-hidden="true"></span>
          </button>
          <ul class="nav-dropdown-menu" role="list">
            <li><a href="xenium.html">Xenium iST</a></li>
            <li><a href="crispr.html">Pooled CRISPR Technologies</a></li>
            <li><a href="chemgenomics.html">Chemical Genomics Screens</a></li>
            <li><a href="phenotypic.html">Arrayed Phenotypic Screens</a></li>
          </ul>
        </li>
        <li><a href="team.html">Team</a></li>
        <li><a href="#contact">Contact</a></li>
      </ul>
    </nav>
  </header>

  <!-- ─── Main ─────────────────────────────────────────── -->
  <main class="page-main">
    <h1 class="calc-page-title">ATG-C Xenium Service Price Calculator</h1>
    <p class="calc-page-subtitle">Estimate the cost of your Xenium spatial transcriptomics project.</p>

    <div class="calc-card">

      <!-- Version -->
      <div class="form-group">
        <label for="version">10X Xenium Technology Version</label>
        <select id="version">
          <option value="v1">v1</option>
          <option value="prime">Prime / 5k</option>
        </select>
      </div>

      <!-- Number of runs -->
      <div class="form-group">
        <label for="numRuns">Number of 2-Slide Runs</label>
        <select id="numRuns">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
        </select>
      </div>

      <!-- Panel type -->
      <div class="form-group">
        <label for="panelType">Panel Type</label>
        <select id="panelType">
          <option value="premade">Pre-made panel</option>
          <option value="standalone">Standalone custom panel</option>
          <option value="combined">Pre-made panel + custom add-on panel</option>
        </select>
      </div>

      <!-- Dynamic panel selectors (populated by JS) -->
      <div class="form-group" id="premadePanelGroup" style="display:none;">
        <label for="premadePanel">Select Pre-made Panel</label>
        <select id="premadePanel"></select>
        <p class="panel-empty" id="premadeEmpty" style="display:none;">No pre-made panels available for Prime / 5k.</p>
      </div>

      <div class="form-group" id="standalonePanelGroup" style="display:none;">
        <label for="standalonePanel">Select Standalone Custom Panel</label>
        <select id="standalonePanel"></select>
        <p class="panel-empty" id="standaloneEmpty" style="display:none;">No standalone panels available for this configuration.</p>
      </div>

      <div class="form-group" id="addonPanelGroup" style="display:none;">
        <label for="addonPanel">Select Custom Add-on Panel</label>
        <select id="addonPanel"></select>
        <p class="panel-empty" id="addonEmpty" style="display:none;">No add-on panels available for this configuration.</p>
      </div>

      <!-- Results -->
      <div class="results" id="results">
        <p class="results-heading">Cost Breakdown</p>
        <div id="resultLines"></div>
      </div>

    </div><!-- /calc-card -->
  </main>

  <!-- ===== FOOTER / CONTACT ===== -->
  <footer class="site-footer" id="contact">
    <div class="container footer-inner">
      <div class="footer-brand">
        <img src="images/atgc-logo-white.svg" alt="ATG-C" width="120" height="34" class="footer-logo">
        <p class="footer-tagline">Advanced Technologies for Genomics CoLab</p>
      </div>
      <div class="footer-links">
        <a href="mailto:genome@columbia.edu">genome@columbia.edu</a>
        <a href="https://cumc.corefacilities.org/sc/5438/genome-engineering-core-facility-systems-biology/?tab=services" target="_blank" rel="noopener">iLab</a>
      </div>
      <p class="footer-copy">&copy; 2025 ATG-C</p>
    </div>
  </footer>

  <script src="js/main.js"></script>

  <!-- ─── Calculator Logic ─────────────────────────────── -->
  <script>
  (function () {
    'use strict';

    /* ================================================================
       PRICING DATA
       Update these objects when 10x pricing changes.
       ================================================================ */

    var baseRunCosts = {
      v1:    11500,
      prime: 20000
    };

    // ── v1 panels ──────────────────────────────────────────

    var v1PremadePanels = {
      "Mouse Brain Gene Expression Panel":            327.75,
      "Human Breast Gene Expression Panel":           327.75,
      "Human Brain Gene Expression Panel":            327.75,
      "Human Lung Gene Expression Panel":             327.75,
      "Human Multi-Tissue and Cancer Panel":          665.00,
      "Mouse Multi-Tissue Atlassing Panel":           665.00,
      "Human Colon Gene Expression Panel":            327.75,
      "Human Skin Gene Expression Panel":             327.75,
      "Human Immuno-Oncology Profiling Panel":        665.00
    };

    var v1StandalonePanels = {
      "Standalone Custom 1-50 Gene Panel (4 rxns)":     { price: 3372.50, runs: 2 },
      "Standalone Custom 1-50 Gene Panel (16 rxns)":    { price: 4560.00, runs: 8 },
      "Standalone Custom 51-100 Gene Panel (4 rxns)":   { price: 5367.50, runs: 2 },
      "Standalone Custom 51-100 Gene Panel (16 rxns)":  { price: 7600.00, runs: 8 },
      "Standalone Custom 101-300 Gene Panel (4 rxns)":  { price: 11020.00, runs: 2 },
      "Standalone Custom 301-480 Gene Panel (4 rxns)":  { price: 16957.50, runs: 2 },
      "Standalone Custom 301-480 Gene Panel (16 rxns)": { price: 27645.00, runs: 8 }
    };

    var v1AddonPanels = {
      "Add-on Custom 1-50 Gene Panel (4 rxns)":                { price: 3372.50, runs: 2 },
      "Custom Gene Expression Panel (up to 50 genes)":         { price: 4560.00, runs: 8 },
      "Add-on Custom 51-100 Gene Panel (4 rxns)":              { price: 5367.50, runs: 2 },
      "Custom Gene Expression Panel (51-100 genes)":           { price: 7600.00, runs: 8 }
    };

    // ── Prime / 5k panels ──────────────────────────────────

    var primePremadePanels    = {};   // none currently available
    var primeStandalonePanels = {};   // none currently available

    var primeAddonPanels = {
      "Prime 5K Add-on Custom up to 50 Gene Panel (12 rxns)": { price: 3800.00, runs: 6 },
      "Prime 5K Add-on Custom 51-100 Gene Panel (12 rxns)":   { price: 6650.00, runs: 6 }
    };

    /* ================================================================
       DOM REFERENCES
       ================================================================ */

    var elVersion          = document.getElementById('version');
    var elNumRuns          = document.getElementById('numRuns');
    var elPanelType        = document.getElementById('panelType');

    var elPremadeGroup     = document.getElementById('premadePanelGroup');
    var elPremadeSelect    = document.getElementById('premadePanel');
    var elPremadeEmpty     = document.getElementById('premadeEmpty');

    var elStandaloneGroup  = document.getElementById('standalonePanelGroup');
    var elStandaloneSelect = document.getElementById('standalonePanel');
    var elStandaloneEmpty  = document.getElementById('standaloneEmpty');

    var elAddonGroup       = document.getElementById('addonPanelGroup');
    var elAddonSelect      = document.getElementById('addonPanel');
    var elAddonEmpty       = document.getElementById('addonEmpty');

    var elResultLines      = document.getElementById('resultLines');

    /* ================================================================
       HELPERS
       ================================================================ */

    /** Format a number as US-dollar string, e.g. "$1,234.56" */
    function fmt(n) {
      return '$' + n.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    /** Return entries of a kit-panel object, filtered for 8-run kits when numRuns >= 3 */
    function filterKitPanels(panels, numRuns) {
      var entries = Object.keys(panels).map(function (k) { return [k, panels[k]]; });
      if (numRuns >= 3) {
        return entries.filter(function (e) { return e[1].runs === 8; });
      }
      return entries;
    }

    /** Populate a <select> with premade panel options (simple price-per-run). */
    function populatePremade(selectEl, panels) {
      selectEl.innerHTML = '';
      var keys = Object.keys(panels);
      keys.forEach(function (name) {
        var opt = document.createElement('option');
        opt.value = name;
        opt.textContent = name + ' (' + fmt(panels[name]) + ' per run)';
        selectEl.appendChild(opt);
      });
      return keys.length;
    }

    /** Populate a <select> with kit-panel options (price for N runs). */
    function populateKit(selectEl, entries) {
      selectEl.innerHTML = '';
      entries.forEach(function (e) {
        var name = e[0];
        var details = e[1];
        var opt = document.createElement('option');
        opt.value = name;
        opt.textContent = name + ' (' + fmt(details.price) + ' for ' + details.runs + ' runs)';
        selectEl.appendChild(opt);
      });
      return entries.length;
    }

    /* ================================================================
       MAIN UPDATE
       ================================================================ */

    function update() {
      var version   = elVersion.value;
      var numRuns   = parseInt(elNumRuns.value, 10);
      var panelType = elPanelType.value;

      // ── Pick the right panel catalogues ──────────────────
      var premadeCat    = version === 'v1' ? v1PremadePanels    : primePremadePanels;
      var standaloneCat = version === 'v1' ? v1StandalonePanels : primeStandalonePanels;
      var addonCat      = version === 'v1' ? v1AddonPanels      : primeAddonPanels;

      // ── Show / hide panel selectors ──────────────────────
      var showPremade    = (panelType === 'premade' || panelType === 'combined');
      var showStandalone = (panelType === 'standalone');
      var showAddon      = (panelType === 'combined');

      elPremadeGroup.style.display    = showPremade    ? '' : 'none';
      elStandaloneGroup.style.display = showStandalone ? '' : 'none';
      elAddonGroup.style.display      = showAddon      ? '' : 'none';

      // ── Populate selects & handle empty states ───────────
      if (showPremade) {
        var premadeCount = populatePremade(elPremadeSelect, premadeCat);
        elPremadeSelect.style.display = premadeCount > 0 ? '' : 'none';
        elPremadeEmpty.style.display  = premadeCount > 0 ? 'none' : '';
      }

      if (showStandalone) {
        var standaloneEntries = filterKitPanels(standaloneCat, numRuns);
        var standaloneCount = populateKit(elStandaloneSelect, standaloneEntries);
        elStandaloneSelect.style.display = standaloneCount > 0 ? '' : 'none';
        elStandaloneEmpty.style.display  = standaloneCount > 0 ? 'none' : '';
      }

      if (showAddon) {
        var addonEntries = filterKitPanels(addonCat, numRuns);
        var addonCount = populateKit(elAddonSelect, addonEntries);
        elAddonSelect.style.display = addonCount > 0 ? '' : 'none';
        elAddonEmpty.style.display  = addonCount > 0 ? 'none' : '';
      }

      // ── Calculate costs ──────────────────────────────────
      var baseRunCost  = baseRunCosts[version];
      var totalRunCost = baseRunCost * numRuns;
      var panelCosts   = [];

      // Premade panel cost (per-run pricing)
      if (showPremade && Object.keys(premadeCat).length > 0) {
        var selectedPremade = elPremadeSelect.value;
        if (selectedPremade && premadeCat[selectedPremade] !== undefined) {
          var perRun = premadeCat[selectedPremade];
          panelCosts.push({
            label: 'Pre-made Panel',
            cost:  perRun * numRuns,
            desc:  numRuns + ' run' + (numRuns > 1 ? 's' : '') + ' @ ' + fmt(perRun) + '/run'
          });
        }
      }

      // Standalone custom panel cost (kit pricing)
      if (showStandalone) {
        var selectedStandalone = elStandaloneSelect.value;
        if (selectedStandalone && standaloneCat[selectedStandalone]) {
          var info = standaloneCat[selectedStandalone];
          var mult = Math.ceil(numRuns / info.runs);
          panelCosts.push({
            label: 'Standalone Custom Panel',
            cost:  info.price * mult,
            desc:  mult + ' \u00d7 ' + info.runs + '-run kit' + (mult > 1 ? 's' : '')
          });
        }
      }

      // Add-on panel cost (kit pricing)
      if (showAddon) {
        var selectedAddon = elAddonSelect.value;
        if (selectedAddon && addonCat[selectedAddon]) {
          var aInfo = addonCat[selectedAddon];
          var aMult = Math.ceil(numRuns / aInfo.runs);
          panelCosts.push({
            label: 'Custom Add-on Panel',
            cost:  aInfo.price * aMult,
            desc:  aMult + ' \u00d7 ' + aInfo.runs + '-run kit' + (aMult > 1 ? 's' : '')
          });
        }
      }

      var totalPanelCost = panelCosts.reduce(function (sum, p) { return sum + p.cost; }, 0);
      var totalPrice     = totalRunCost + totalPanelCost;
      var perRunPrice    = totalPrice / numRuns;

      // ── Render results ───────────────────────────────────
      var html = '';

      // Base run line
      html += '<div class="result-line">';
      html += '  <span class="label">Base run cost</span>';
      html += '  <span class="value">' + fmt(baseRunCost) + ' &times; ' + numRuns + ' = ' + fmt(totalRunCost) + '</span>';
      html += '</div>';

      // Panel cost lines
      panelCosts.forEach(function (p) {
        html += '<div class="result-line">';
        html += '  <span class="label">' + p.label + '</span>';
        html += '  <span class="value">' + fmt(p.cost) + '</span>';
        html += '</div>';
        html += '<div class="result-line indent">';
        html += '  <span class="label">' + p.desc + '</span>';
        html += '  <span class="value"></span>';
        html += '</div>';
      });

      // Divider + total
      html += '<hr class="result-divider">';
      html += '<div class="result-total">';
      html += '  <span>Total Project Cost</span>';
      html += '  <span>' + fmt(totalPrice) + '</span>';
      html += '</div>';

      // Per-run
      html += '<div class="result-per-run">';
      html += '  <span>Cost per run</span>';
      html += '  <span>' + fmt(perRunPrice) + '</span>';
      html += '</div>';

      // Note about 8-run kits
      if (numRuns >= 3) {
        html += '<div class="cost-note">';
        html += 'For 3 or more runs, an 8-run kit is more cost-effective than multiple 2-run kits.';
        html += '</div>';
      }

      elResultLines.innerHTML = html;
    }

    /* ================================================================
       EVENT LISTENERS — recalculate on any change
       ================================================================ */

    elVersion.addEventListener('change', function () {
      // When version changes, reset panel type to premade (mirroring React behaviour
      // of resetting selections). Then update.
      update();
    });

    elNumRuns.addEventListener('change', update);
    elPanelType.addEventListener('change', update);
    elPremadeSelect.addEventListener('change', update);
    elStandaloneSelect.addEventListener('change', update);
    elAddonSelect.addEventListener('change', update);

    // Initial render
    update();

  })();
  </script>

</body>
</html>
